<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="keywords" content="hughsie Richard Hughes Hughski Limited ColorHug" />
<meta name="description" content="Hughski Limited" />
<meta name="author" content="Richard Hughes" />
<title>Hughski - ColorHug</title>
<link rel="stylesheet" href="style.css" type="text/css" media="screen" />
<link rel="shortcut icon" href="favicon.ico"/>
<style type="text/css" media="screen">
 body { background: url("img/kubrickbgcolor.jpg"); } 
 #page { background: url("img/kubrickbgwide.jpg") repeat-y top; border: none; } 
 #header { background: url("img/kubrickheader.jpg") no-repeat bottom center; }
 #footer { background: url("img/kubrickfooter.jpg") no-repeat bottom; border: none;}
</style>
</head>
<body>
<div id="page">
<div id="header">
 <div id="headerimg">
  <h1 class="title"><a href="http://www.hughsie.com/">Hughski Limited</a></h1>
  <div class="description">Open source color management hardware</div>
 </div>
</div>
<hr />
 <div id="content" class="widecolumn">
  <div class="navigation">
   <div class="alignleft"><a href="owner.html">Introduction</a></div>
   <div class="alignleft">&nbsp;&laquo; <a href="calibrate.html">Calibration</a></div>
   <div class="alignright"></div>
  </div>
  <div class="post">

<h1>Factory Calibrating the ColorHug</h1>

<p>
To factory calibrate the ColorHug you need a
photospectrometer, e.g. a ColorMunki and the xcalib software installed.
</p>
<p>
Ensure your screen has been turned on for at least 30 minutes.
</p>

<h2>Calculating the dark offsets</h2>
<p>
Place the ColorHug on a black dark surface and press down to ensure
no light leaks into the aperture.
Do a raw measurement using:
</p>
<pre>
/usr/libexec/colorhug set-dark-offsets 0 0 0
xset dpms force off && sleep 5 && /usr/libexec/colorhug take-readings && xset dpms force on
R:0.0002 G:0.0001 B:0.0001
</pre>
<p>
These can then be programmed into the ColorHug using:
</p>
<pre>
/usr/libexec/colorhug set-dark-offsets 0.0002 0.0001 0.0001
/usr/libexec/colorhug write-eeprom "Un1c0rn2"
</pre>

<h2>Working out the calibration matrix</h2>
<p>
We first generate a ti1 file containing a list of patches to measure:
</p>
<pre>
targen -d3 patches
</pre>

<p>
Then we measure the patches using the photospectrometer which creates a
ti3 file from the ti1 file.
For this bit you have to attach your photospectrometer to the computer
and disconnect the ColorHug.
Note, you <b>need</b> to use the <code>-s</code> flag to ensure that
the spectral data is saved.
</p>
<pre>
dispread -d2 -yl -s patches
mv patches.ti3 colormunki-hp-lp240zx-srgb.ti3
</pre>

<p>
Then we measure the reset the screen and device to default, and
measure the spectral response using the ColorHug.
So, remove the photospectrometer and attach the ColorHug.
</p>
<pre>
xcalib -c
/usr/libexec/colorhug set-calibration-map 0 0 0 0 0 0
/usr/libexec/colorhug set-calibration-ccmx 0 unity.ccmx
/usr/libexec/colorhug write-eeprom "Un1c0rn2"

dispread -d2 -yl patches
mv patches.ti3 calibration.ti3
</pre>

<p>
With the two .ti3 files, we can generate a colorimeter calibration matrix:
</p>
<pre>
export ccxx_desc="Factory-Calibration"
export ccxx_ref="colormunki-hp-lp240zx-srgb.ti3"
export ccxx_src="calibration.ti3"
export ccxx_mat="calibration.ccmx"
ccxxmake -I $ccxx_desc -T LCD -D$ccxx_desc -f $ccxx_ref,$ccxx_src $ccxx_mat
/usr/libexec/colorhug set-calibration-ccmx 0 calibration.ccmx
</pre>

  </div><!-- end post -->
 </div>
<hr />
<div id="footer">
 <p>
  Hughski.com is managed by
  <a href="mailto:richard@hughsie.com">Richard Hughes</a><br/>
  <a href="http://validator.w3.org/check/referer">Optimized</a>
  for <a href="http://www.w3.org/">standards</a>.
 </p>
</div>
</div>
</body>
</html>
